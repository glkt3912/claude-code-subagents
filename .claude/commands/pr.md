---
description: 日本語でGitHub Pull Requestを作成（変更内容を分析し、適切なPR文を生成）
args: "[base_branch]"
---

# Pull Request作成

現在のブランチから指定のベースブランチへのPRを、日本語で適切に作成します。

## 使い方

```bash
/pr [base_branch]
```

**引数**:
- `base_branch` (オプション): マージ先のベースブランチ名
  - 省略時は自動検出: `gh repo view --json defaultBranchRef` または `git symbolic-ref refs/remotes/origin/HEAD`
  - 検出できない場合はmainを使用

## 例

- `/pr` - 現在のブランチ → デフォルトブランチ（自動検出）へのPR作成
- `/pr develop` - 現在のブランチ → develop へのPR作成
- `/pr staging` - 現在のブランチ → staging へのPR作成

## 実行内容

1. 現在のブランチを確認（これがPRのソースブランチになります）
2. `git diff [base_branch]...HEAD` で変更内容を分析
3. `git log [base_branch]..HEAD` でコミット履歴を確認
4. 以下のテンプレートに沿ってPR本文を生成
5. `gh pr create --base [base_branch]` コマンドの実行方法を提示

## PRテンプレート構造

```markdown
## 概要
<!-- タスク管理ツールのURL、Issueへのリンク、変更の背景 -->
<!-- 例: Closes #123 -->

## 変更内容
<!-- この変更で何ができるようになったか、何が改善されたか -->

### スクリーンショット
<!-- UI変更がある場合は Before / After を添付 -->

## 技術的な変更の詳細
<!-- 実装方法、使用したライブラリ、設計判断の理由 -->
<!-- なぜこの方法を選んだのかを将来の開発者のために記録 -->

## やらなかったこと
<!-- 意図的にやらなかったこと、今後の課題として残したこと -->
<!-- レビュアーの「これはやらないの？」という疑問を事前に解消 -->

## 影響範囲
- [ ] フロントエンド
- [ ] バックエンド
- [ ] データベース
- [ ] インフラ
- [ ] 外部API連携

### 懸念点・注意事項
<!-- この変更により影響を受ける可能性がある箇所、リスク -->

## 動作確認
- [ ] ローカル環境で動作確認済み
- [ ] 既存のテストが全て通過
- [ ] 新規テストを追加（必要な場合）
- [ ] エッジケースの確認
- [ ] パフォーマンスへの影響確認

## レビュワーへ
<!-- 特に見てほしい箇所、判断を仰ぎたい点など -->

## デプロイ時の注意
<!-- 環境変数の追加、マイグレーション実行、設定変更などが必要な場合 -->
```

## 私が実行すること

1. **現在のブランチ確認**: `git branch --show-current` でソースブランチを特定
2. **ベースブランチ決定**:
   - 引数が指定されていればそれを使用
   - 省略時は以下の順で検出を試行:
     - `gh repo view --json defaultBranchRef -q .defaultBranchRef.name` (GitHub CLI)
     - `git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'`
     - フォールバック: `main`
3. **変更内容分析**: `git diff [base]...HEAD` で差分を確認
4. **コミット履歴分析**: `git log [base]..HEAD` から変更意図を読み取る
5. **影響範囲判定**: 変更ファイルから自動推定（フロントエンド/バックエンド等）
6. **PR本文生成**: 日本語テンプレートに沿って本文を作成
7. **コマンド提示**: `gh pr create --base [base_branch]` の実行方法を提示

**注意**: このコマンドは現在のブランチからベースブランチへのPRを作成します。
デフォルトブランチ（main/master等）で実行した場合は、適切なfeatureブランチに切り替えてから実行してください。

Base branch: ${1:-<auto-detect>}
